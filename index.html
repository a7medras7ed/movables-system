<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ğŸ“‹ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù†Ù‚ÙˆÙ„Ø§Øª</title>
<script src="https://cdn.tailwindcss.com"></script>
<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<style>
  body {
    font-family: 'Cairo', sans-serif;
    background: #f3f6fa;
  }
  table {
    border-collapse: collapse;
    width: 100%;
  }
  th, td {
    border: 1px solid #ccc;
    padding: 8px;
    text-align: center;
  }
  th { background-color: #e3f2fd; }
  .modal {
    position: fixed; top: 0; left: 0; width: 100%; height: 100%;
    display: none; justify-content: center; align-items: center;
    background: rgba(0,0,0,0.4); z-index: 1000;
  }
</style>
</head>
<body class="p-4 text-center bg-gray-100">

<h1 class="text-2xl md:text-3xl font-bold text-blue-700 mb-4">ğŸ“‹ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù†Ù‚ÙˆÙ„Ø§Øª</h1>

<!-- ğŸ§¾ Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ -->
<form id="form" class="flex flex-wrap justify-center gap-2 mb-4">
  <input id="name" type="text" placeholder="Ø§Ø³Ù… Ø§Ù„Ø¹Ù†ØµØ±" required
    class="border rounded-lg px-3 py-2 w-full sm:w-48 focus:outline-blue-500">
  <input id="qty" type="number" placeholder="Ø§Ù„ÙƒÙ…ÙŠØ©" required
    class="border rounded-lg px-3 py-2 w-full sm:w-32 focus:outline-blue-500">
  <input id="price" type="number" placeholder="Ø§Ù„Ø³Ø¹Ø±" required
    class="border rounded-lg px-3 py-2 w-full sm:w-32 focus:outline-blue-500">
  <button class="bg-blue-600 hover:bg-blue-700 text-white rounded-lg px-4 py-2 w-full sm:w-auto">â• Ø¥Ø¶Ø§ÙØ©</button>
  <button type="button" id="clear" class="bg-red-600 hover:bg-red-700 text-white rounded-lg px-4 py-2 w-full sm:w-auto">ğŸ—‘ Ù…Ø³Ø­ Ø§Ù„ÙƒÙ„</button>
</form>

<!-- ğŸ” Ø§Ù„Ø¨Ø­Ø« ÙˆØ§Ù„ØªØµÙÙŠØ© -->
<div class="flex flex-wrap justify-center gap-2 mb-4">
  <input id="searchBox" type="text" placeholder="ğŸ” Ø¨Ø­Ø«..." 
         class="border rounded-lg px-3 py-2 w-full sm:w-60 focus:outline-blue-500">
  <select id="filterQty" class="border rounded-lg px-3 py-2 w-full sm:w-48 focus:outline-blue-500">
    <option value="all">ØªØµÙÙŠØ© Ø­Ø³Ø¨ Ø§Ù„ÙƒÙ…ÙŠØ©</option>
    <option value="low">ÙƒÙ…ÙŠØ© Ø£Ù‚Ù„ Ù…Ù† 5</option>
    <option value="high">ÙƒÙ…ÙŠØ© 5 ÙØ£ÙƒØ«Ø±</option>
  </select>
</div>

<!-- ğŸ“„ Ø£Ø²Ø±Ø§Ø± PDF ÙˆØ§Ù„Ø·Ø¨Ø§Ø¹Ø© -->
<div class="flex flex-wrap justify-center gap-2 mb-4">
  <button id="savePDF" class="bg-purple-600 hover:bg-purple-700 text-white rounded-lg px-4 py-2 w-full sm:w-auto">ğŸ“„ Ø­ÙØ¸ ÙƒÙ€ PDF</button>
  <button id="printBtn" class="bg-green-600 hover:bg-green-700 text-white rounded-lg px-4 py-2 w-full sm:w-auto">ğŸ–¨ Ø·Ø¨Ø§Ø¹Ø©</button>
</div>

<!-- ğŸ“Š Ø§Ù„Ø¬Ø¯ÙˆÙ„ -->
<div id="pdfContent" class="overflow-x-auto bg-white rounded-lg shadow-md p-3">
  <h2 class="text-xl text-blue-900 mb-3 font-semibold">ğŸ“‹ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù†Ù‚ÙˆÙ„Ø§Øª</h2>
  <table class="min-w-[600px] text-sm">
    <thead>
      <tr>
        <th>Ø±Ù‚Ù…</th><th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th><th>Ø§Ù„Ø¹Ù†ØµØ±</th>
        <th>Ø§Ù„ÙƒÙ…ÙŠØ©</th><th>Ø§Ù„Ø³Ø¹Ø±</th><th>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</th>
        <th class="action-col">Ø¹Ù…Ù„ÙŠØ§Øª</th>
      </tr>
    </thead>
    <tbody id="body"></tbody>
    <tfoot>
      <tr>
        <td colspan="5" class="text-right font-bold">ğŸ’° Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙƒÙ„ÙŠ:</td>
        <td id="total" class="font-bold">0</td>
        <td class="action-col"></td>
      </tr>
    </tfoot>
  </table>
</div>

<!-- âœï¸ Ù†Ø§ÙØ°Ø© Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ -->
<div id="editModal" class="modal">
  <div class="bg-white p-4 rounded-lg w-11/12 sm:w-96">
    <h3 class="text-lg font-semibold text-blue-700 mb-2">âœï¸ ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¹Ù†ØµØ±</h3>
    <label class="block text-right">Ø§Ø³Ù… Ø§Ù„Ø¹Ù†ØµØ±</label>
    <input type="text" id="editName" class="border rounded-lg px-2 py-1 w-full mb-2">
    <label class="block text-right">Ø§Ù„ÙƒÙ…ÙŠØ©</label>
    <input type="number" id="editQty" class="border rounded-lg px-2 py-1 w-full mb-2">
    <label class="block text-right">Ø§Ù„Ø³Ø¹Ø±</label>
    <input type="number" id="editPrice" class="border rounded-lg px-2 py-1 w-full mb-2">
    <div class="text-left mt-2 flex gap-2 justify-end">
      <button id="saveEdit" class="bg-blue-600 text-white px-4 py-1 rounded-lg">ğŸ’¾ Ø­ÙØ¸</button>
      <button id="cancelEdit" class="bg-red-600 text-white px-4 py-1 rounded-lg">Ø¥Ù„ØºØ§Ø¡</button>
    </div>
  </div>
</div>

<script>
let items=[], editIndex=null;
const form=document.getElementById('form'),
      body=document.getElementById('body'),
      totalEl=document.getElementById('total'),
      clearBtn=document.getElementById('clear'),
      searchBox=document.getElementById('searchBox'),
      filterQty=document.getElementById('filterQty'),
      editModal=document.getElementById('editModal'),
      editName=document.getElementById('editName'),
      editQty=document.getElementById('editQty'),
      editPrice=document.getElementById('editPrice'),
      saveEdit=document.getElementById('saveEdit'),
      cancelEdit=document.getElementById('cancelEdit'),
      savePDF=document.getElementById('savePDF'),
      printBtn=document.getElementById('printBtn');

form.onsubmit=e=>{
  e.preventDefault();
  const name=document.getElementById('name').value.trim(),
        qty=parseFloat(document.getElementById('qty').value),
        price=parseFloat(document.getElementById('price').value);
  if(!name||qty<=0||price<=0)return;
  const date=new Date().toLocaleDateString('ar-EG');
  items.push({name,qty,price,date});
  render();form.reset();
};

clearBtn.onclick=()=>{if(confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§ØªØŸ')){items=[];render();}};

function render(){
  body.innerHTML='';let total=0;
  const search=searchBox.value.trim().toLowerCase();
  const filter=filterQty.value;
  let filtered=items.filter(it=>it.name.toLowerCase().includes(search));
  if(filter==='low')filtered=filtered.filter(it=>it.qty<5);
  else if(filter==='high')filtered=filtered.filter(it=>it.qty>=5);

  filtered.forEach((it,i)=>{
    const sum=it.qty*it.price;total+=sum;
    body.innerHTML+=`
      <tr>
        <td>${i+1}</td><td>${it.date}</td><td>${it.name}</td>
        <td>${it.qty}</td><td>${it.price}</td><td>${sum.toFixed(2)}</td>
        <td class="action-col">
          <button class="bg-orange-500 text-white rounded px-2 py-1 text-xs" onclick="openEdit(${i})">ØªØ¹Ø¯ÙŠÙ„</button>
          <button class="bg-red-600 text-white rounded px-2 py-1 text-xs" onclick="deleteItem(${i})">Ø­Ø°Ù</button>
        </td>
      </tr>`;
  });
  totalEl.textContent=total.toFixed(2);
}

function deleteItem(i){if(confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø¹Ù†ØµØ±ØŸ')){items.splice(i,1);render();}}
searchBox.oninput=render;
filterQty.onchange=render;

function openEdit(i){
  editIndex=i;
  const it=items[i];
  editName.value=it.name;
  editQty.value=it.qty;
  editPrice.value=it.price;
  editModal.style.display='flex';
}
cancelEdit.onclick=()=>{editModal.style.display='none';};
saveEdit.onclick=()=>{
  if(editIndex===null)return;
  const n=editName.value.trim(),q=parseFloat(editQty.value),p=parseFloat(editPrice.value);
  if(!n||q<=0||p<=0)return;
  items[editIndex]={...items[editIndex],name:n,qty:q,price:p};
  editIndex=null;editModal.style.display='none';render();
};
window.onclick=e=>{if(e.target===editModal)editModal.style.display='none';};

// âœ… Ø­ÙØ¸ ÙƒÙ€ PDF (ÙŠØ¯Ø¹Ù… Ø§Ù„ØµÙØ­Ø§Øª Ø§Ù„Ø·ÙˆÙŠÙ„Ø© ÙˆØ§Ù„Ø¹Ø±ÙŠØ¶Ø© Ø¨Ø§Ù„ÙƒØ§Ù…Ù„)
savePDF.onclick = () => {
  if (items.length === 0) return alert("Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª!");
  const { jsPDF } = window.jspdf;
  document.querySelectorAll(".action-col").forEach(el => el.style.display = "none");

  html2canvas(document.getElementById("pdfContent"), {
    scale: 2,
    useCORS: true,
    scrollY: -window.scrollY,
    windowWidth: document.getElementById("pdfContent").scrollWidth,
    windowHeight: document.getElementById("pdfContent").scrollHeight
  }).then(canvas => {
    const imgData = canvas.toDataURL("image/png");
    const pdf = new jsPDF("p", "pt", "a4"); // ØºÙŠÙ‘Ø± Ø¥Ù„Ù‰ "l" Ù„Ùˆ Ø¹Ø§ÙŠØ² Ø£ÙÙ‚ÙŠ
    const pageWidth = pdf.internal.pageSize.getWidth();
    const pageHeight = pdf.internal.pageSize.getHeight();
    const imgWidth = pageWidth;
    const imgHeight = (canvas.height * imgWidth) / canvas.width;

    let heightLeft = imgHeight;
    let position = 0;

    pdf.addImage(imgData, "PNG", 0, position, imgWidth, imgHeight);
    heightLeft -= pageHeight;

    while (heightLeft > 0) {
      position = heightLeft - imgHeight;
      pdf.addPage();
      pdf.addImage(imgData, "PNG", 0, position, imgWidth, imgHeight);
      heightLeft -= pageHeight;
    }

    pdf.save("Ù‚Ø§Ø¦Ù…Ø©-Ø§Ù„Ù…Ù†Ù‚ÙˆÙ„Ø§Øª.pdf");
    document.querySelectorAll(".action-col").forEach(el => el.style.display = "");
  });
};

// ğŸ–¨ Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© Ø¨Ø¯ÙˆÙ† Ø¹Ù…ÙˆØ¯ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª
printBtn.onclick=()=>{
  if(items.length===0)return alert("Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„Ø·Ø¨Ø§Ø¹Ø©!");
  const table=document.getElementById('pdfContent').cloneNode(true);
  table.querySelectorAll('.action-col').forEach(el=>el.remove());
  const w=window.open("","_blank");
  w.document.write(`
    <html lang="ar" dir="rtl">
    <head><meta charset="UTF-8">
    <style>
      body{font-family:'Cairo',sans-serif;direction:rtl;text-align:center}
      table{width:100%;border-collapse:collapse;margin-top:20px}
      th,td{border:1px solid #ccc;padding:6px;text-align:center}
      th{background-color:#e3f2fd}
    </style></head>
    <body>
      <h2>ğŸ“‹ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù†Ù‚ÙˆÙ„Ø§Øª</h2>
      ${table.innerHTML}
    </body></html>`);
  w.document.close();w.print();
};
</script>
</body>
</html>
