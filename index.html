<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ğŸ“‹ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù†Ù‚ÙˆÙ„Ø§Øª</title>
<script src="https://cdn.tailwindcss.com"></script>
<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<style>
body {
  font-family: 'Cairo', sans-serif;
  background: #f3f6fa;
  direction: rtl;
  text-align: center;
  padding: 10px;
}
table {
  width: 100%;
  border-collapse: collapse;
  font-size: 0.9rem;
}
th, td {
  border: 1px solid #ccc;
  padding: 6px;
  text-align: center;
}
th {
  background-color: #e3f2fd;
}
.btn {
  padding: 8px 12px;
  margin: 3px;
  border-radius: 8px;
  color: #fff;
  cursor: pointer;
  border: none;
  font-weight: 600;
  font-size: 0.9rem;
}
.add { background: #1976d2; }
.clear { background: #d32f2f; }
.edit { background: #f57c00; }
.pdf { background: #6a1b9a; }
.print { background: #388e3c; }
#tableContainer {
  background: #fff;
  max-width: 100%;
  overflow-x: auto;
  margin: auto;
  padding: 10px;
  border-radius: 10px;
  box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}
input, select {
  border: 1px solid #bbb;
  border-radius: 6px;
  padding: 8px;
  width: 100%;
  max-width: 180px;
  margin: 3px;
}
.modal {
  position: fixed; top: 0; left: 0;
  width: 100%; height: 100%;
  display: none; justify-content: center; align-items: center;
  background: rgba(0,0,0,0.4);
  z-index: 1000;
}
.modal-content {
  background: #fff; padding: 20px;
  border-radius: 10px; max-width: 90%;
  text-align: right;
}
.modal input {
  width: 100%; padding: 8px;
  margin: 6px 0; border: 1px solid #ccc;
  border-radius: 6px;
}

/* âœ… ØªØ­Ø³ÙŠÙ† Ø§Ù„Ø¹Ø±Ø¶ Ø¹Ù„Ù‰ Ø§Ù„Ø´Ø§Ø´Ø§Øª Ø§Ù„ØµØºÙŠØ±Ø© */
@media (max-width: 640px) {
  body { font-size: 0.9rem; }
  h1 { font-size: 1.5rem; }
  table { font-size: 0.8rem; }
  th, td { padding: 4px; }
  #tableContainer { padding: 5px; }
  form, .actions { display: flex; flex-wrap: wrap; justify-content: center; }
  .btn { flex: 1 1 40%; margin: 4px; font-size: 0.8rem; }
  input, select { max-width: 45%; flex: 1 1 45%; }
}
</style>
</head>
<body>

<h1 class="text-2xl font-bold text-blue-700 mb-4">ğŸ“‹ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù†Ù‚ÙˆÙ„Ø§Øª</h1>

<form id="form" class="flex flex-wrap justify-center gap-2 mb-3">
  <input id="name" type="text" placeholder="Ø§Ø³Ù… Ø§Ù„Ø¹Ù†ØµØ±" required>
  <input id="qty" type="number" placeholder="Ø§Ù„ÙƒÙ…ÙŠØ©" required>
  <input id="price" type="number" placeholder="Ø§Ù„Ø³Ø¹Ø±" required>
  <button class="btn add" type="submit">â• Ø¥Ø¶Ø§ÙØ©</button>
  <button class="btn clear" type="button" id="clear">ğŸ—‘ Ù…Ø³Ø­ Ø§Ù„ÙƒÙ„</button>
</form>

<div class="actions mb-2">
  <input id="searchBox" type="text" placeholder="ğŸ” Ø¨Ø­Ø«..." />
  <select id="filterQty">
    <option value="all">ØªØµÙÙŠØ© Ø­Ø³Ø¨ Ø§Ù„ÙƒÙ…ÙŠØ©</option>
    <option value="low">ÙƒÙ…ÙŠØ© Ø£Ù‚Ù„ Ù…Ù† 5</option>
    <option value="high">ÙƒÙ…ÙŠØ© 5 ÙØ£ÙƒØ«Ø±</option>
  </select>
</div>

<div class="actions mb-2">
  <button class="btn pdf" id="savePDF">ğŸ“„ Ø­ÙØ¸ ÙƒÙ€ PDF</button>
  <button class="btn print" id="printBtn">ğŸ–¨ Ø·Ø¨Ø§Ø¹Ø©</button>
</div>

<div id="pdfContent">
  <div id="tableContainer">
    <h2 style="color:#1a237e;font-size:20px;margin-bottom:10px;">ğŸ“‹ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù†Ù‚ÙˆÙ„Ø§Øª</h2>
    <table>
      <thead>
        <tr>
          <th>Ø±Ù‚Ù…</th><th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th><th>Ø§Ù„Ø¹Ù†ØµØ±</th><th>Ø§Ù„ÙƒÙ…ÙŠØ©</th><th>Ø§Ù„Ø³Ø¹Ø±</th><th>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</th><th class="action-col">Ø¹Ù…Ù„ÙŠØ§Øª</th>
        </tr>
      </thead>
      <tbody id="body"></tbody>
      <tfoot><tr><td colspan="5" style="text-align:right;">ğŸ’° Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙƒÙ„ÙŠ:</td><td id="total">0</td><td class="action-col"></td></tr></tfoot>
    </table>
  </div>
</div>

<!-- Ù†Ø§ÙØ°Ø© Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ -->
<div class="modal" id="editModal">
  <div class="modal-content">
    <h3 class="text-lg font-semibold text-blue-700 mb-2">âœï¸ ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¹Ù†ØµØ±</h3>
    <label>Ø§Ø³Ù… Ø§Ù„Ø¹Ù†ØµØ±</label>
    <input type="text" id="editName">
    <label>Ø§Ù„ÙƒÙ…ÙŠØ©</label>
    <input type="number" id="editQty">
    <label>Ø§Ù„Ø³Ø¹Ø±</label>
    <input type="number" id="editPrice">
    <div style="text-align:left;margin-top:10px;">
      <button class="btn add" id="saveEdit">ğŸ’¾ Ø­ÙØ¸</button>
      <button class="btn clear" id="cancelEdit">Ø¥Ù„ØºØ§Ø¡</button>
    </div>
  </div>
</div>

<script>
let items=[], editIndex=null;
const form=document.getElementById('form'),
      body=document.getElementById('body'),
      totalEl=document.getElementById('total'),
      clearBtn=document.getElementById('clear'),
      searchBox=document.getElementById('searchBox'),
      filterQty=document.getElementById('filterQty'),
      editModal=document.getElementById('editModal'),
      editName=document.getElementById('editName'),
      editQty=document.getElementById('editQty'),
      editPrice=document.getElementById('editPrice'),
      saveEdit=document.getElementById('saveEdit'),
      cancelEdit=document.getElementById('cancelEdit'),
      savePDF=document.getElementById('savePDF'),
      printBtn=document.getElementById('printBtn');

form.onsubmit=e=>{
  e.preventDefault();
  const name=document.getElementById('name').value.trim(),
        qty=parseFloat(document.getElementById('qty').value),
        price=parseFloat(document.getElementById('price').value);
  if(!name||qty<=0||price<=0)return;
  const date=new Date().toLocaleDateString('ar-EG');
  items.push({name,qty,price,date});
  render();form.reset();
};

clearBtn.onclick=()=>{if(confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§ØªØŸ')){items=[];render();}};

function render(){
  body.innerHTML='';let total=0;
  const search=searchBox.value.trim().toLowerCase();
  const filter=filterQty.value;
  let filtered=items.filter(it=>it.name.toLowerCase().includes(search));
  if(filter==='low')filtered=filtered.filter(it=>it.qty<5);
  else if(filter==='high')filtered=filtered.filter(it=>it.qty>=5);

  filtered.forEach((it,i)=>{
    const sum=it.qty*it.price;total+=sum;
    body.innerHTML+=`
      <tr>
        <td>${i+1}</td><td>${it.date}</td><td>${it.name}</td>
        <td>${it.qty}</td><td>${it.price}</td><td>${sum.toFixed(2)}</td>
        <td class="action-col">
          <button class="btn edit" onclick="openEdit(${i})">ØªØ¹Ø¯ÙŠÙ„</button>
          <button class="btn clear" onclick="deleteItem(${i})">Ø­Ø°Ù</button>
        </td>
      </tr>`;
  });
  totalEl.textContent=total.toFixed(2);
}

function deleteItem(i){if(confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø¹Ù†ØµØ±ØŸ')){items.splice(i,1);render();}}
searchBox.oninput=render;
filterQty.onchange=render;

function openEdit(i){
  editIndex=i;
  const it=items[i];
  editName.value=it.name;
  editQty.value=it.qty;
  editPrice.value=it.price;
  editModal.style.display='flex';
}
cancelEdit.onclick=()=>{editModal.style.display='none';};
saveEdit.onclick=()=>{
  if(editIndex===null)return;
  const n=editName.value.trim(),q=parseFloat(editQty.value),p=parseFloat(editPrice.value);
  if(!n||q<=0||p<=0)return;
  items[editIndex]={...items[editIndex],name:n,qty:q,price:p};
  editIndex=null;editModal.style.display='none';render();
};
window.onclick=e=>{if(e.target===editModal)editModal.style.display='none';};

// âœ… PDF Ø¨Ø¯ÙˆÙ† Ø¹Ù…ÙˆØ¯ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª
savePDF.onclick=()=>{
  if(items.length===0)return alert("Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª!");
  const {jsPDF}=window.jspdf;
  document.querySelectorAll(".action-col").forEach(el=>el.style.display="none");
  html2canvas(document.getElementById("tableContainer"),{scale:2,useCORS:true}).then(canvas=>{
    const img=canvas.toDataURL("image/png");
    const pdf=new jsPDF("p","pt","a4");
    const width=pdf.internal.pageSize.getWidth();
    const height=(canvas.height*width)/canvas.width;
    pdf.addImage(img,"PNG",0,0,width,height);
    pdf.save("Ù‚Ø§Ø¦Ù…Ø©-Ø§Ù„Ù…Ù†Ù‚ÙˆÙ„Ø§Øª.pdf");
    document.querySelectorAll(".action-col").forEach(el=>el.style.display="");
  });
};

// ğŸ–¨ Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© Ø¨Ø¯ÙˆÙ† Ø¹Ù…ÙˆØ¯ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª
printBtn.onclick=()=>{
  if(items.length===0)return alert("Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„Ø·Ø¨Ø§Ø¹Ø©!");
  const table=document.getElementById('tableContainer').cloneNode(true);
  table.querySelectorAll('.action-col').forEach(el=>el.remove());
  const w=window.open("","_blank");
  w.document.write(`
    <html lang="ar" dir="rtl">
    <head><meta charset="UTF-8">
    <style>
      body{font-family:'Cairo',sans-serif;direction:rtl;text-align:center}
      table{width:100%;border-collapse:collapse;margin-top:20px}
      th,td{border:1px solid #ccc;padding:6px;text-align:center}
      th{background-color:#e3f2fd}
      h2{font-size:20px;color:#1a237e;margin-bottom:20px;}
    </style></head>
    <body>
      <h2>ğŸ“‹ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù†Ù‚ÙˆÙ„Ø§Øª</h2>
      ${table.innerHTML}
    </body></html>`);
  w.document.close();w.print();
};
</script>
</body>
</html>
